# This file was generated by Render's heroku-import Heroku CLI plugin
# https://www.npmjs.com/package/@renderinc/heroku-import
# Schema documented at https://render.com/docs/yaml-spec
services:
    - type: web # valid values: https://render.com/docs/yaml-spec#type
      region: ohio
      name: sample-service-name
      env: python # valid values: https://render.com/docs/yaml-spec#environment
      buildCommand: "./render_build.sh"
      # Run migrations before starting the web process so the database schema is up-to-date.
      # This keeps deploys simple; alternatively you can run the job below from the Render dashboard
      # once after the database is provisioned.
      startCommand: "bash -lc \"export FLASK_APP=src/app.py && flask db upgrade && gunicorn wsgi --chdir ./src/\""
      plan: free # optional; defaults to starter
      numInstances: 1
      envVars:
        - key: VITE_BASENAME # Imported from Heroku app
          value: /
        - key: FLASK_APP # Imported from Heroku app
          value: src/app.py
        - key: FLASK_DEBUG # Imported from Heroku app
          value: 0
        - key: FLASK_APP_KEY # Imported from Heroku app
          value: "any key works"
        - key: PYTHON_VERSION
          value: 3.10.6
        - key: DATABASE_URL # Render PostgreSQL database
          fromDatabase:
            name: postgresql-trapezoidal-42170
            property: connectionString

databases: # Render PostgreSQL database
    - name: postgresql-trapezoidal-42170
      region: ohio
      ipAllowList: [] # only allow internal connections
      plan: free # optional; defaults to starter

jobs:
  # Optional migration job you can trigger from the Render dashboard or wire into CI.
  - type: job
    name: run-migrations
    env: python
    region: ohio
    plan: free
    # Ensure FLASK_APP is set and the DATABASE_URL is injected from the managed DB
    command: bash -lc "export FLASK_APP=src/app.py && flask db upgrade"
    envVars:
      - key: PYTHON_VERSION
        value: 3.10.6
      - key: DATABASE_URL
        fromDatabase:
          name: postgresql-trapezoidal-42170
          property: connectionString
